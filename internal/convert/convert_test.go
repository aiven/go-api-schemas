// Package convert is the package that contains the convert functionality.
package convert

import (
	"testing"

	"github.com/aiven/aiven-go-client/v2"
	"github.com/google/go-cmp/cmp"

	"github.com/aiven/go-api-schemas/internal/pkg/types"
	"github.com/aiven/go-api-schemas/internal/pkg/util"
)

// TestUserConfigSchema tests the UserConfigSchema function.
// nolint:funlen,lll // This function is long, but it's a test function.
// // These lines are long, but they're test data.
func TestUserConfigSchema(t *testing.T) {
	type args struct {
		v aiven.UserConfigSchema
	}

	tests := []struct {
		name    string
		args    args
		want    *types.UserConfigSchema
		wantErr error
	}{
		{
			name: "basic",
			args: args{
				v: aiven.UserConfigSchema{
					Title:                "",
					Description:          "",
					Type:                 nil,
					Default:              nil,
					Required:             nil,
					Properties:           nil,
					AdditionalProperties: nil,
					Items:                nil,
					OneOf:                nil,
					Enum:                 nil,
					Minimum:              util.Ref(0.0),
					Maximum:              util.Ref(0.0),
					MinLength:            util.Ref(0),
					MaxLength:            util.Ref(0),
					MaxItems:             util.Ref(0),
					CreateOnly:           false,
					Pattern:              "",
					Example:              nil,
					UserError:            "",
				},
			},
			want: &types.UserConfigSchema{
				UserConfigSchemaDeprecationInfo: types.UserConfigSchemaDeprecationInfo{},
				Title:                           "",
				Description:                     "",
				Type:                            nil,
				Default:                         nil,
				Required:                        nil,
				Properties:                      nil,
				Items:                           nil,
				OneOf:                           nil,
				Enum:                            []types.UserConfigSchemaEnumValue{},
				Minimum:                         util.Ref(0.0),
				Maximum:                         util.Ref(0.0),
				MinLength:                       util.Ref(0),
				MaxLength:                       util.Ref(0),
				MaxItems:                        util.Ref(0),
				CreateOnly:                      false,
				Pattern:                         "",
				Example:                         nil,
				UserError:                       "",
			},
			wantErr: nil,
		},
		{
			name: "filled",
			args: args{
				v: aiven.UserConfigSchema{
					Title:       "",
					Description: "",
					Type:        "object",
					Default:     nil,
					Required: []string{
						"datadog_api_key",
					},
					Properties: map[string]aiven.UserConfigSchema{
						"max_partition_contexts": {
							Title:                "Maximum number of partition contexts to send",
							Description:          "",
							Type:                 "integer",
							Default:              nil,
							Required:             nil,
							Properties:           nil,
							AdditionalProperties: nil,
							Items:                nil,
							OneOf:                nil,
							Enum:                 nil,
							Minimum:              util.Ref(200.0),
							Maximum:              util.Ref(200000.0),
							MinLength:            util.Ref(0),
							MaxLength:            util.Ref(0),
							MaxItems:             util.Ref(0),
							CreateOnly:           false,
							Pattern:              "",
							Example:              "32000",
							UserError:            "",
						},
						"site": {
							Title:                "Datadog intake site. Defaults to datadoghq.com",
							Description:          "",
							Type:                 "string",
							Default:              nil,
							Required:             nil,
							Properties:           nil,
							AdditionalProperties: nil,
							Items:                nil,
							OneOf:                nil,
							Enum: []interface{}{
								"datadoghq.com",
								"datadoghq.eu",
							},
							Minimum:    util.Ref(0.0),
							Maximum:    util.Ref(0.0),
							MinLength:  util.Ref(0),
							MaxLength:  util.Ref(0),
							MaxItems:   util.Ref(0),
							CreateOnly: false,
							Pattern:    "",
							Example:    "datadoghq.com",
							UserError:  "",
						},
						"datadog_api_key": {
							Title:                "Datadog API key",
							Description:          "",
							Type:                 "string",
							Default:              nil,
							Required:             nil,
							Properties:           nil,
							AdditionalProperties: nil,
							Items:                nil,
							OneOf:                nil,
							Enum:                 nil,
							Minimum:              util.Ref(0.0),
							Maximum:              util.Ref(0.0),
							MinLength:            util.Ref(0),
							MaxLength:            util.Ref(0),
							MaxItems:             util.Ref(0),
							CreateOnly:           false,
							Pattern:              "^[A-Za-z0-9]{32}$",
							Example:              "848f30907c15c55d601fe45487cce9b6",
							UserError:            "Must consist of alpha-numeric characters and contain 32 characters",
						},
						"datadog_tags": {
							Title:                "Custom tags provided by user",
							Description:          "",
							Type:                 "array",
							Default:              nil,
							Required:             nil,
							Properties:           nil,
							AdditionalProperties: nil,
							Items:                nil,
							OneOf:                nil,
							Enum:                 nil,
							Minimum:              util.Ref(0.0),
							Maximum:              util.Ref(0.0),
							MinLength:            util.Ref(0),
							MaxLength:            util.Ref(0),
							MaxItems:             util.Ref(0),
							CreateOnly:           false,
							Pattern:              "",
							Example: []interface{}{
								map[string]interface{}{"tag": "foo"},
								map[string]interface{}{
									"comment": "Useful tag",
									"tag":     "bar:buzz",
								},
							},
							UserError: "",
						},
						"disable_consumer_stats": {
							Title:                "Disable consumer group metrics",
							Description:          "",
							Type:                 "boolean",
							Default:              nil,
							Required:             nil,
							Properties:           nil,
							AdditionalProperties: nil,
							Items:                nil,
							OneOf:                nil,
							Enum:                 nil,
							Minimum:              util.Ref(0.0),
							Maximum:              util.Ref(0.0),
							MinLength:            util.Ref(0),
							MaxLength:            util.Ref(0),
							MaxItems:             util.Ref(0),
							CreateOnly:           false,
							Pattern:              "",
							Example:              true,
							UserError:            "",
						},
						"kafka_consumer_check_instances": {
							Title:                "Number of separate instances to fetch kafka consumer statistics with",
							Description:          "",
							Type:                 "integer",
							Default:              nil,
							Required:             nil,
							Properties:           nil,
							AdditionalProperties: nil,
							Items:                nil,
							OneOf:                nil,
							Enum:                 nil,
							Minimum:              util.Ref(1.0),
							Maximum:              util.Ref(100.0),
							MinLength:            util.Ref(0),
							MaxLength:            util.Ref(0),
							MaxItems:             util.Ref(0),
							CreateOnly:           false,
							Pattern:              "",
							Example:              "8",
							UserError:            "",
						},
						"kafka_consumer_stats_timeout": {
							Title:                "Number of seconds that datadog will wait to get consumer statistics from brokers",
							Description:          "",
							Type:                 "integer",
							Default:              nil,
							Required:             nil,
							Properties:           nil,
							AdditionalProperties: nil,
							Items:                nil,
							OneOf:                nil,
							Enum:                 nil,
							Minimum:              util.Ref(2.0),
							Maximum:              util.Ref(600.0),
							MinLength:            util.Ref(0),
							MaxLength:            util.Ref(0),
							MaxItems:             util.Ref(0),
							CreateOnly:           false,
							Pattern:              "",
							Example:              "60",
							UserError:            "",
						},
					},
					AdditionalProperties: false,
					Items:                nil,
					OneOf:                nil,
					Enum:                 nil,
					Minimum:              util.Ref(0.0),
					Maximum:              util.Ref(0.0),
					MinLength:            util.Ref(0),
					MaxLength:            util.Ref(0),
					MaxItems:             util.Ref(0),
					CreateOnly:           false,
					Pattern:              "",
					Example:              nil,
					UserError:            "",
				},
			},
			want: &types.UserConfigSchema{
				UserConfigSchemaDeprecationInfo: types.UserConfigSchemaDeprecationInfo{},
				Title:                           "",
				Description:                     "",
				Type:                            "object",
				Default:                         nil,
				Required: []string{
					"datadog_api_key",
				},
				Properties: map[string]types.UserConfigSchema{
					"datadog_api_key": {
						UserConfigSchemaDeprecationInfo: types.UserConfigSchemaDeprecationInfo{},
						Title:                           "Datadog API key",
						Description:                     "",
						Type:                            "string",
						Default:                         nil,
						Required:                        nil,
						Properties:                      nil,
						Items:                           nil,
						OneOf:                           nil,
						Enum:                            []types.UserConfigSchemaEnumValue{},
						Minimum:                         util.Ref(0.0),
						Maximum:                         util.Ref(0.0),
						MinLength:                       util.Ref(0),
						MaxLength:                       util.Ref(0),
						MaxItems:                        util.Ref(0),
						CreateOnly:                      false,
						Pattern:                         "^[A-Za-z0-9]{32}$",
						Example:                         "848f30907c15c55d601fe45487cce9b6",
						UserError:                       "Must consist of alpha-numeric characters and contain 32 characters",
					},
					"datadog_tags": {
						UserConfigSchemaDeprecationInfo: types.UserConfigSchemaDeprecationInfo{},
						Title:                           "Custom tags provided by user",
						Description:                     "",
						Type:                            "array",
						Default:                         nil,
						Required:                        nil,
						Properties:                      nil,
						Items:                           nil,
						OneOf:                           nil,
						Enum:                            []types.UserConfigSchemaEnumValue{},
						Minimum:                         util.Ref(0.0),
						Maximum:                         util.Ref(0.0),
						MinLength:                       util.Ref(0),
						MaxLength:                       util.Ref(0),
						MaxItems:                        util.Ref(0),
						CreateOnly:                      false,
						Pattern:                         "",
						Example: []interface{}{
							map[string]interface{}{"tag": "foo"},
							map[string]interface{}{
								"comment": "Useful tag",
								"tag":     "bar:buzz",
							},
						},
						UserError: "",
					},
					"disable_consumer_stats": {
						UserConfigSchemaDeprecationInfo: types.UserConfigSchemaDeprecationInfo{},
						Title:                           "Disable consumer group metrics",
						Description:                     "",
						Type:                            "boolean",
						Default:                         nil,
						Required:                        nil,
						Properties:                      nil,
						Items:                           nil,
						OneOf:                           nil,
						Enum:                            []types.UserConfigSchemaEnumValue{},
						Minimum:                         util.Ref(0.0),
						Maximum:                         util.Ref(0.0),
						MinLength:                       util.Ref(0),
						MaxLength:                       util.Ref(0),
						MaxItems:                        util.Ref(0),
						CreateOnly:                      false,
						Pattern:                         "",
						Example:                         true,
						UserError:                       "",
					},
					"kafka_consumer_check_instances": {
						UserConfigSchemaDeprecationInfo: types.UserConfigSchemaDeprecationInfo{},
						Title:                           "Number of separate instances to fetch kafka consumer statistics with",
						Description:                     "",
						Type:                            "integer",
						Default:                         nil,
						Required:                        nil,
						Properties:                      nil,
						Items:                           nil,
						OneOf:                           nil,
						Enum:                            []types.UserConfigSchemaEnumValue{},
						Minimum:                         util.Ref(1.0),
						Maximum:                         util.Ref(100.0),
						MinLength:                       util.Ref(0),
						MaxLength:                       util.Ref(0),
						MaxItems:                        util.Ref(0),
						CreateOnly:                      false,
						Pattern:                         "",
						Example:                         "8",
						UserError:                       "",
					},
					"kafka_consumer_stats_timeout": {
						UserConfigSchemaDeprecationInfo: types.UserConfigSchemaDeprecationInfo{},
						Title:                           "Number of seconds that datadog will wait to get consumer statistics from brokers",
						Description:                     "",
						Type:                            "integer",
						Default:                         nil,
						Required:                        nil,
						Properties:                      nil,
						Items:                           nil,
						OneOf:                           nil,
						Enum:                            []types.UserConfigSchemaEnumValue{},
						Minimum:                         util.Ref(2.0),
						Maximum:                         util.Ref(600.0),
						MinLength:                       util.Ref(0),
						MaxLength:                       util.Ref(0),
						MaxItems:                        util.Ref(0),
						CreateOnly:                      false,
						Pattern:                         "",
						Example:                         "60",
						UserError:                       "",
					},
					"max_partition_contexts": {
						UserConfigSchemaDeprecationInfo: types.UserConfigSchemaDeprecationInfo{},
						Title:                           "Maximum number of partition contexts to send",
						Description:                     "",
						Type:                            "integer",
						Default:                         nil,
						Required:                        nil,
						Properties:                      nil,
						Items:                           nil,
						OneOf:                           nil,
						Enum:                            []types.UserConfigSchemaEnumValue{},
						Minimum:                         util.Ref(200.0),
						Maximum:                         util.Ref(200000.0),
						MinLength:                       util.Ref(0),
						MaxLength:                       util.Ref(0),
						MaxItems:                        util.Ref(0),
						CreateOnly:                      false,
						Pattern:                         "",
						Example:                         "32000",
						UserError:                       "",
					},
					"site": {
						UserConfigSchemaDeprecationInfo: types.UserConfigSchemaDeprecationInfo{},
						Title:                           "Datadog intake site. Defaults to datadoghq.com",
						Description:                     "",
						Type:                            "string",
						Default:                         nil,
						Required:                        nil,
						Properties:                      nil,
						Items:                           nil,
						OneOf:                           nil,
						Enum: []types.UserConfigSchemaEnumValue{
							{Value: "datadoghq.com"},
							{Value: "datadoghq.eu"},
						},
						Minimum:    util.Ref(0.0),
						Maximum:    util.Ref(0.0),
						MinLength:  util.Ref(0),
						MaxLength:  util.Ref(0),
						MaxItems:   util.Ref(0),
						CreateOnly: false,
						Pattern:    "",
						Example:    "datadoghq.com",
						UserError:  "",
					},
				},
				Items:      nil,
				OneOf:      nil,
				Enum:       []types.UserConfigSchemaEnumValue{},
				Minimum:    util.Ref(0.0),
				Maximum:    util.Ref(0.0),
				MinLength:  util.Ref(0),
				MaxLength:  util.Ref(0),
				MaxItems:   util.Ref(0),
				CreateOnly: false,
				Pattern:    "",
				Example:    nil,
				UserError:  "",
			},
			wantErr: nil,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			got, err := UserConfigSchema(tt.args.v)
			if !cmp.Equal(err, tt.wantErr) {
				t.Errorf("UserConfigSchema() error = %v, wantErr %v", err, tt.wantErr)

				return
			}

			if !cmp.Equal(got, tt.want) {
				t.Errorf(cmp.Diff(tt.want, got))
			}
		})
	}
}
